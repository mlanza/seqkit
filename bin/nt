#!/usr/bin/env deno run --allow-run
const [sub, ...rest] = Deno.args

if (!sub) {
  console.error("usage: nt <subcommand> [...args]")
  Deno.exit(2)
}

let exe = `${import.meta.dirname}/nt.d/${sub}`

const cmd = new Deno.Command(exe, {
  args: rest,
  stdin: "inherit",
  stdout: "inherit",
  stderr: "inherit"
})

try {
  const child = cmd.spawn()
  const status = await child.status
  Deno.exit(status.code)
} catch (err) {
  if (err instanceof Deno.errors.NotFound) {
    // Delegate to notes as catchall
    exe = `${import.meta.dirname}/nt.d/notes`
    const notesCmd = new Deno.Command(exe, {
      args: [sub, ...rest],
      stdin: "inherit",
      stdout: "inherit",
      stderr: "inherit"
    })
    const notesChild = notesCmd.spawn()
    const notesStatus = await notesChild.status
    Deno.exit(notesStatus.code)
  }
  throw err
}
